# File to set tests
# The syntax is the following:
# test1:
#   testset: machine1 machine2 # subfolders where tests be run
#   command: ./test1 param1 # command to test
#   needed: dir1/file*txt dir2 # files needed
#   excluded: dir1/file0.txt dir2/file1 # file to exclude
#   checkfiles: dir2/file1 # files used to check validity
#   checkscript: ./check.sh # script to check validity
# test2:
#   ...

extract:
  testset: avakas plafrim plafrim2
  copy: %=txz
  needed: %/ib-raw
  command: mkdir %/netloc; $NETLOC_UTIL_PATH/infiniband/netloc_ib_extract_dats %/ib-raw
  checkfiles: %/netloc/*txt

draw:
  testset: avakas plafrim plafrim2
  copy: %=txz
  needed: %/netloc %/hwloc
  excluded: $NETLOC_TEST/netloc/*json
  command: $NETLOC_UTIL_PATH/draw/netloc_draw_to_json %
  checkfiles: $NETLOC_TEST/netloc/*json

rank_file:
  testset: scotch
  copy: % plafrim2=txz
  needed: % plafrim2/netloc/*txt plafrim2/hwloc
  command:  ./%/test_mpi_rank_file.sh
  checkcommand: test -f test.rank && ! grep -vlP "^rank \d+=[^\s]+ slot=\d+$" test.rank
